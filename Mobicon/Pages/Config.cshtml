@page
@using Models
@using Newtonsoft.Json
@model Mobicon.Pages.ConfigModel
@{
    ViewData["Title"] = "Config";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<script>
    function onEditClick(data) {
        var obj = JSON.parse(data);

        $('input[name="entryId"]').val(obj.Id);
        $('input[name="key"]').val(obj.Key)
            .prop('disabled', true);
        $('input[name="value"]').val(obj.Value);
        $('input[name="description"]').val(obj.Description);
        $('input[name="jira"]').val(obj.Jira);
        $('input[name="type"]').val(obj.Type);
        $('#addEditModal').modal('show');
    }

    function onDeleteClick(data) {
        var obj = JSON.parse(data);

        $('input[name="entryId"]').val(obj.Id);

        $('#deleteModal').modal('show');
    }

    function onAddClick() {
        $('input[name="entryId"]').val('');
        $('input[name="key"]').val('')
            .prop('disabled', false);;
        $('input[name="value"]').val('');
        $('input[name="description"]').val('');
        $('input[name="jira"]').val('');
        $('input[name="type"]').val('');

        $('#addEditModal').modal('show');
    }
</script>


<!-- Delete Modal -->
<div class="modal" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Delete</h5>
            </div>
            <form method="post" asp-page-handler="delete" class="form-inline">
                <input type="hidden" class="form-control mb-2 mr-sm-2" name="entryId">

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                    <button type="submit" class="btn btn-primary">Destroy this crap!</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add/Edit Modal -->
<div class="modal " id="addEditModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalVerticalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalVerticalLabel">Add/Edit</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="post" class="form-inline">
                <div class="modal-body">

                    <input type="hidden" class="form-control mb-2 mr-sm-2" name="entryId">
                    <input type="text" class="form-control mb-2 mr-sm-2" name="key" placeholder="Key">
                    <input type="text" class="form-control mb-2 mr-sm-2" name="value" placeholder="Value">

                    <select class="form-control mb-2 mr-sm-2" name="type" id="exampleFormControlSelect1">
                        @foreach (var type in Model.FieldTypes)
                        {
                            <option>@type</option>
                        }
                    </select>

                    <input type="text" class="form-control mb-2 mr-sm-2" name="description" placeholder="Description">
                    <input type="text" class="form-control mb-2 mr-sm-2" name="jira" placeholder="Jira">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>

        </div>
    </div>
</div>

<button type="button" class="btn btn-success" onclick="onAddClick()">Add new</button>
<hr/>

<table>
    <thead class="table table-borderless">
    <tr>
        <th>#</th>
        <th>Prefixes</th>
        <th>Key</th>
        <th>Value</th>
        <th>Type</th>
        <th>Description</th>
        <th>Jira</th>
    </tr>
    </thead>
    <tbody>
    @{
        foreach (var entry in Model.Entries)
        {
            <tr data="@JsonConvert.SerializeObject(entry)">
                
                <td>
                    <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">
                        <button type="button" class="btn btn-success" onclick="onEditClick($(this).closest('tr').attr('data'))">Edit</button>
                        <button type="button" class="btn btn-danger" onclick="onDeleteClick($(this).closest('tr').attr('data'))">Delete</button>
                    </div>
                </td>
                <td>@string.Join(", ", entry.SimplePrefixes.Select(e => e.SimplePrefix.Name))</td>
                <td>@entry.Key</td>
                @switch (entry.Type)
                {
                    case FieldType.String:
                    case FieldType.Integer:
                    case FieldType.Float:
                    case FieldType.Bool:
                        <td>@entry.Value</td>
                        break;
                    case FieldType.ListOfBool:
                    case FieldType.ListOfString:
                    case FieldType.ListOfInteger:
                    case FieldType.ListOfFloat:
                        <td>List...</td>
                        break;
                    default:
                        <td>Unknown</td>
                        break;
                }
                <td>@entry.Type</td>
                <td>@entry.Description</td>
                <td><a href="https://jira.playtika.com/browse/@entry.Jira">@entry.Jira</a></td>
            </tr>
        }
                }
    </tbody>
</table>